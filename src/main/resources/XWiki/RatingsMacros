<?xml version="1.0" encoding="ISO-8859-1"?>

<xwikidoc>
<web>XWiki</web>
<name>RatingsMacros</name>
<language></language>
<defaultLanguage>en</defaultLanguage>
<translation>0</translation>
<parent></parent>
<creator>XWiki.Admin</creator>
<author>XWiki.Admin</author>
<customClass></customClass>
<contentAuthor>XWiki.Admin</contentAuthor>
<creationDate>1225742161000</creationDate>
<date>1225742548000</date>
<contentUpdateDate>1225742548000</contentUpdateDate>
<version>2.1</version>
<title></title>
<template></template>
<defaultTemplate></defaultTemplate>
<validationScript></validationScript>
<comment></comment>
<minorEdit>false</minorEdit>
<syntaxId>xwiki/1.0</syntaxId>
<object>
<class>
<name>XWiki.TagClass</name>
<customClass></customClass>
<customMapping></customMapping>
<defaultViewSheet></defaultViewSheet>
<defaultEditSheet></defaultEditSheet>
<defaultWeb></defaultWeb>
<nameField></nameField>
<validationScript></validationScript>
<tags>
<cache>0</cache>
<displayType>input</displayType>
<multiSelect>1</multiSelect>
<name>tags</name>
<number>1</number>
<prettyName>Tags</prettyName>
<relationalStorage>1</relationalStorage>
<separator> </separator>
<separators> ,|</separators>
<size>30</size>
<unmodifiable>0</unmodifiable>
<values></values>
<classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
</tags>
</class>
<name>XWiki.RatingsMacros</name>
<number>0</number>
<className>XWiki.TagClass</className>
<property>
<tags/>
</property>
</object>
<content>###
###    Display rating stars UI
###
###
#macro(ratingstars $id $cssclass $ratinglabel $rating $nbVotes $locked)
#set($width = $rating * 20)
&lt;div class="rating-container $cssclass" id="$id"&gt;
    &lt;div class="rating-header $cssclass"&gt;$ratinglabel&lt;/div&gt;
    &lt;div class="rating-stars"&gt;
        &lt;ul class="star-rating ${cssclass}-star #if($locked) locked #end"&gt;
            &lt;li class="current-rating" style="width:${width}%;"&gt;&lt;/li&gt;
            #set($cls = ["one-star", "two-stars", "three-stars", "four-stars", "five-stars"])
            #foreach($r in [1..5])
                #set($i = $r - 1)
                &lt;li&gt;&lt;a href="#" title="$msg.get("rating.${cls.get($i)}")" class="$cls.get($i)"&gt;$r&lt;/a&gt;&lt;/li&gt;
            #end
        &lt;/ul&gt;
    &lt;/div&gt;
    &lt;div class="rating-message"&gt;#if($nbVotes != "")&lt;span&gt;$nbVotes&lt;/span&gt;&amp;nbsp;$msg.get("rating.votes")#end&lt;/div&gt;
&lt;/div&gt;
#end

###
###    Display full ratings UI ( rating ui, number of votes, user's vote)
###
###
#macro(displayFullRating $rdoc $method)
#set($id = $xwiki.getUniquePageName("string").replaceAll("[0-9]*", "").toLowerCase())
#if($method != "")  #set($ar = $xwiki.ratings.getAverageRating($rdoc, $method))
#else  #set($ar = $xwiki.ratings.getAverageRating($rdoc)) #end
#set($avgvote = $ar.averageVote)
#set($uservote = $xwiki.ratings.getRating($rdoc, $context.user).vote)
#set($votes = $ar.nbVotes)
&lt;div class="rating-wrapper" id="rating-${rdoc.fullName}"&gt;
#if($xwiki.checkAuth())
 &lt;div class="avg-rating"&gt;#ratingstars($id "" $msg.get("rating.rate") $avgvote $votes false)&lt;/div&gt;
 &lt;div class="user-rating"&gt;#ratingstars("${id}-user" "small" $msg.get("rating.yourvote") $uservote "" true)&lt;/div&gt;
#else
 #set($loginurl = $xwiki.getURL("XWiki.XWikiLogin", "login", "xredirect=$rdoc.getURL()"))
 &lt;div class="avg-rating"&gt;#ratingstars($id "" $msg.get("rating.rate") $avgvote  $votes true)&lt;/div&gt; 
 &lt;div class="login-to-rate"&gt;&lt;a href="$loginurl"&gt;$msg.get("rating.logintorate")&lt;/a&gt;&lt;/div&gt;
#end
&lt;/div&gt;
#end
    
###
###    Display small ratings UI ( rating ui - display only )
###
###
#macro(displaySmallRating $rdoc $method)
#set($id = $xwiki.getUniquePageName("string").replaceAll("[0-9]*", "").toLowerCase())
#if($method != "")  #set($ar = $xwiki.ratings.getAverageRating($rdoc, $method))
#else  #set($ar = $xwiki.ratings.getAverageRating($rdoc)) #end
#set($avgvote = $ar.averageVote)
#ratingstars($id "small" "" $avgvote "" true)
#end
</content></xwikidoc>